class MokoRoute extends HTMLElement{static get observedAttributes(){return["path","component","selected"]}removeFirstSlash(t){return 0===t.indexOf("/")?t.substring(1):t}attributeChangedCallback(t,e,s){"path"===t?this._path=this.removeFirstSlash(s):"component"===t?this._element||(this._element=s):"selected"===t&&(this._selected=s)}get path(){return this._path}get customElement(){return this._element}set path(t){this.setAttribute("path",t)}get selected(){return this._selected}set selected(t){this.setAttribute("selected",t)}}customElements.define("moko-route",MokoRoute);const customElement=(t,e=[])=>{const s=class extends HTMLElement{static get observedAttributes(){return[...e]}constructor(){super(),this.connectedCallbackNumCalls=0}async connectedCallback(){if(this.connectedCallbackNumCalls>0)return;const e=t.bind(this);this.toRender=await e(this),"string"==typeof this.toRender?this.innerHTML=this.toRender:(this.toRender instanceof HTMLElement||this.toRender instanceof DocumentFragment)&&this.appendChild(this.toRender),this.connectedCallbackNumCalls++}};return e.forEach(t=>{Object.defineProperty(s.prototype,t,{set(e){this.setAttribute(t,e)},get(){return this.getAttribute(t)}})}),s},Link=customElement(function(){const t=this.innerHTML,e=document.createElement("a");return e.href=this.to,e.innerHTML=t,e.onclick=(t=>{t.preventDefault(),t.stopPropagation(),this.closest("moko-switch-navigator, moko-stack-navigator","moko-tab-navigator").navigate(this.to)}),this.innerHTML="",e},["to"]);function isLocationPathMatchingRoute(t,e){const s=/(:\w+)/g,n=e.match(s)||[];let o=[];n.length>0&&(o=n.map(t=>t.slice(1)));const a=new RegExp(e.replace(s,"(\\w+)")),i=t.match(a);let r={};if(i){const[t,...e]=i;for(var h=0;h<n.length;h++)r[o[h]]=e[h]}return{match:i,urlData:r}}customElements.define("moko-link",Link);class NavigatorElement extends HTMLElement{constructor(){super()}extractChildRoutes(){this.routes=Array.from(this.children).filter(t=>"MOKO-ROUTE"===t.tagName)}searchAncestor(t){const e=t[0].parentElement.closest("moko-switch-navigator, moko-stack-navigator, moko-tab-navigator");return e?this.searchAncestor([e,...t]):t}getContentElement(){return this.routes[this.routes.length-1].nextElementSibling}connectedCallback(){this.extractChildRoutes(),this.navigators||(this.navigators=this.searchAncestor([this])),this.urlData={...this.navigators.reduce((t,e)=>({...t,...e.urlData}),{})},addEventListener("hashchange",this)}disconnectedCallback(){removeEventListener("hashchange",this)}navigate(t){location.hash=`${this.getAncestorMatchedRoute()}/${t}`}getAncestorMatchedRoute(){return this.navigators.slice(0,this.navigators.length-1).reduce((t,e)=>t+"/"+e.matchedRouteLocation,"")}getCurrentRelativeLocation(t=this.getAncestorMatchedRoute()){let e=location.hash.substring(1).replace(t,"");return e="/"===e[0]?e.replace("/",""):e}searchMatchingRoute(){let t,e,s,n,o=this.getAncestorMatchedRoute(),a=this.getCurrentRelativeLocation(o);if(""===a)this.matchedRouteLocation="";else{for(const o of this.routes){o.selected=!1;const i=isLocationPathMatchingRoute(a,o.path);if(i.match){e=i,(t=o).selected=!0,s=(n=e.match[0])!==this.matchedRouteLocation;break}}s&&(this.matchedRouteLocation=n,this.urlData={...this.urlData,...e.urlData})}return{matchedRoute:t,matchedResult:e,ancestorMatchedRoute:o,routeChanged:s}}}class MokoSwitchNavigator extends NavigatorElement{connectedCallback(){super.connectedCallback(),this.style.display="block",this.style.height="inherit",this.style.width="inherit",this.style.position="relative";const t=this.getAttribute("default-path");this.getContentElement()?this.matchedRouteLocation=t||this.routes[0].path:this.getCurrentRelativeLocation()?setTimeout(()=>this.handleEvent()):this.navigate(t||this.routes[0].path)}handleEvent(){const{matchedResult:t,matchedRoute:e,routeChanged:s}=this.searchMatchingRoute();if(t&&s){Array.from(this.routes).forEach(t=>t.innerHTML="");const s=this.getContentElement();s&&s.remove();const n=document.createElement(e.customElement);Object.keys(this.urlData).forEach(e=>{n.setAttribute(e,t.urlData[e])}),this.appendChild(n),this.dispatchEvent(new CustomEvent("moko-switch-view",{detail:{matchedRoute:e},bubbles:!0}))}}}customElements.define("moko-switch-navigator",MokoSwitchNavigator);export{MokoSwitchNavigator};
