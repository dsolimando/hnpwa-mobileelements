class MokoRoute extends HTMLElement{static get observedAttributes(){return["path","component","selected"]}removeFirstSlash(t){return 0===t.indexOf("/")?t.substring(1):t}attributeChangedCallback(t,e,s){"path"===t?this._path=this.removeFirstSlash(s):"component"===t?this._element||(this._element=s):"selected"===t&&(this._selected=s)}get path(){return this._path}get customElement(){return this._element}set path(t){this.setAttribute("path",t)}get selected(){return this._selected}set selected(t){this.setAttribute("selected",t)}}customElements.define("moko-route",MokoRoute);const customElement=(t,e=[])=>{const s=class extends HTMLElement{static get observedAttributes(){return[...e]}constructor(){super(),this.connectedCallbackNumCalls=0}async connectedCallback(){if(this.connectedCallbackNumCalls>0)return;const e=t.bind(this);this.toRender=await e(this),"string"==typeof this.toRender?this.innerHTML=this.toRender:(this.toRender instanceof HTMLElement||this.toRender instanceof DocumentFragment)&&this.appendChild(this.toRender),this.connectedCallbackNumCalls++}};return e.forEach(t=>{Object.defineProperty(s.prototype,t,{set(e){this.setAttribute(t,e)},get(){return this.getAttribute(t)}})}),s},Link=customElement(function(){const t=this.innerHTML,e=document.createElement("a");return e.href=this.to,e.innerHTML=t,e.onclick=(t=>{t.preventDefault(),t.stopPropagation(),this.closest("moko-switch-navigator, moko-stack-navigator","moko-tab-navigator").navigate(this.to)}),this.innerHTML="",e},["to"]);function isLocationPathMatchingRoute(t,e){const s=/(:\w+)/g,n=e.match(s)||[];let a=[];n.length>0&&(a=n.map(t=>t.slice(1)));const i=new RegExp(e.replace(s,"(\\w+)")),o=t.match(i);let r={};if(o){const[t,...e]=o;for(var h=0;h<n.length;h++)r[a[h]]=e[h]}return{match:o,urlData:r}}customElements.define("moko-link",Link);class NavigatorElement extends HTMLElement{constructor(){super()}extractChildRoutes(){this.routes=Array.from(this.children).filter(t=>"MOKO-ROUTE"===t.tagName)}searchAncestor(t){const e=t[0].parentElement.closest("moko-switch-navigator, moko-stack-navigator, moko-tab-navigator");return e?this.searchAncestor([e,...t]):t}getContentElement(){return this.routes[this.routes.length-1].nextElementSibling}connectedCallback(){this.extractChildRoutes(),this.navigators||(this.navigators=this.searchAncestor([this])),this.urlData={...this.navigators.reduce((t,e)=>({...t,...e.urlData}),{})},addEventListener("hashchange",this)}disconnectedCallback(){removeEventListener("hashchange",this)}navigate(t){location.hash=`${this.getAncestorMatchedRoute()}/${t}`}getAncestorMatchedRoute(){return this.navigators.slice(0,this.navigators.length-1).reduce((t,e)=>t+"/"+e.matchedRouteLocation,"")}getCurrentRelativeLocation(t=this.getAncestorMatchedRoute()){let e=location.hash.substring(1).replace(t,"");return e="/"===e[0]?e.replace("/",""):e}searchMatchingRoute(){let t,e,s,n,a=this.getAncestorMatchedRoute(),i=this.getCurrentRelativeLocation(a);if(""===i)this.matchedRouteLocation="";else{for(const a of this.routes){a.selected=!1;const o=isLocationPathMatchingRoute(i,a.path);if(o.match){e=o,(t=a).selected=!0,s=(n=e.match[0])!==this.matchedRouteLocation;break}}s&&(this.matchedRouteLocation=n,this.urlData={...this.urlData,...e.urlData})}return{matchedRoute:t,matchedResult:e,ancestorMatchedRoute:a,routeChanged:s}}}function createWrapperElement(t){const e=document.createElement("div");return e.style.position="absolute",e.style.width="inherit",e.style.height="inherit",e.style.overflow="hidden",e.style.transition="transform 0.4s cubic-bezier(0.22, 0.61, 0.36, 1)",t&&e.setAttribute("id",t),e}class StackNavigator extends NavigatorElement{static get observedAttributes(){return["modal"]}attributeChangedCallback(t,e,s){"modal"===t&&(this.modal||(this._modal=!(""!==s&&!s)))}get modal(){return this._modal}setUrlData(t){this.urlData&&Object.keys(this.urlData).forEach(e=>{t.setAttribute(e,this.urlData[e])})}handleEvent(t){const{matchedResult:e,routeChanged:s,matchedRoute:n}=this.searchMatchingRoute();if(!e&&this.nextRoute&&this.onscreenFirstRoute(),e&&s){const t=document.createElement(n.customElement);t.style.display="block",this.setUrlData(t),this.nextRoute=createWrapperElement(),this.nextRoute.innerHTML="",this.nextRoute.appendChild(t),this.offscreenNextRoute(),setTimeout(()=>{this.appendChild(this.nextRoute),setTimeout(()=>{this.modal||(this.initialContentElement.style.transform="translateX(-30%)"),this.showNextRouteElement(t)},16)})}}offscreenNextRoute(){this.modal?this.nextRoute.style.transform="translateY(100%)":this.nextRoute.style.transform="translateX(100%)",setTimeout(()=>this.nextRoute.remove,500)}onscreenFirstRoute(){this.modal?this.nextRoute.style.transform="translateY(100%)":(this.nextRoute.style.transform="translateX(100%)",this.initialContentElement.style.transform="translateX(0)")}showNextRouteElement(){this.modal?this.nextRoute.style.transform="translateY(0)":this.nextRoute.style.transform="translateX(0)"}renderFirstRoute(){const t=document.createElement(this.routes[0].customElement);this.setUrlData(t),t.style.display="block";const e=createWrapperElement();e.appendChild(t),this.initialContentElement?this.initialContentElement.replaceWith(e):this.appendChild(e),this.initialContentElement=e}constructor(){super(),this.connectedCallbackNumCalls=0,this.style.position="relative",this.style.height="inherit",this.style.width="inherit",this.style.display="block",this.style.overflow="hidden"}connectedCallback(){super.connectedCallback(),this.initialContentElement=this.getContentElement(),0==this.connectedCallbackNumCalls++&&setTimeout(()=>{this.matchedRouteLocation=this.getAttribute("default-path")||this.routes[0].path,this.renderFirstRoute()})}}customElements.define("moko-stack-navigator",StackNavigator);export{StackNavigator};
