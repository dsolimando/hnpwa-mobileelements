function isLocationPathMatchingRoute(t,e){const a=/(:\w+)/g,o=e.match(a)||[];let s=[];o.length>0&&(s=o.map(t=>t.slice(1)));const i=new RegExp(e.replace(a,"(\\w+)")),n=t.match(i);let r={};if(n){const[t,...e]=n;for(var l=0;l<o.length;l++)r[s[l]]=e[l]}return{match:n,urlData:r}}class NavigatorElement extends HTMLElement{constructor(){super()}extractChildRoutes(){this.routes=Array.from(this.children).filter(t=>"MOKO-ROUTE"===t.tagName)}searchAncestor(t){const e=t[0].parentElement.closest("moko-switch-navigator, moko-stack-navigator, moko-tab-navigator");return e?this.searchAncestor([e,...t]):t}getContentElement(){return this.routes[this.routes.length-1].nextElementSibling}connectedCallback(){this.extractChildRoutes(),this.navigators||(this.navigators=this.searchAncestor([this])),this.urlData={...this.navigators.reduce((t,e)=>({...t,...e.urlData}),{})},addEventListener("hashchange",this)}disconnectedCallback(){removeEventListener("hashchange",this)}navigate(t){location.hash=`${this.getAncestorMatchedRoute()}/${t}`}getAncestorMatchedRoute(){return this.navigators.slice(0,this.navigators.length-1).reduce((t,e)=>t+"/"+e.matchedRouteLocation,"")}getCurrentRelativeLocation(t=this.getAncestorMatchedRoute()){let e=location.hash.substring(1).replace(t,"");return e="/"===e[0]?e.replace("/",""):e}searchMatchingRoute(){let t,e,a,o,s=this.getAncestorMatchedRoute(),i=this.getCurrentRelativeLocation(s);if(""===i)this.matchedRouteLocation="";else{for(const s of this.routes){s.selected=!1;const n=isLocationPathMatchingRoute(i,s.path);if(n.match){e=n,(t=s).selected=!0,a=(o=e.match[0])!==this.matchedRouteLocation;break}}a&&(this.matchedRouteLocation=o,this.urlData={...this.urlData,...e.urlData})}return{matchedRoute:t,matchedResult:e,ancestorMatchedRoute:s,routeChanged:a}}}const tabBarTemplate=document.createElement("template");tabBarTemplate.innerHTML="<slot></slot>\n<style>\n    :host {\n        -webkit-tap-highlight-color: rgba(0,0,0,0);\n        position: absolute;\n        bottom: 0;\n        left: 0;\n        width: 100%;\n        height: 50px;\n        display: flex;\n        background: #fff;\n        padding-bottom: env(safe-area-inset-bottom);\n    }\n\n    ::slotted(moko-tab) {\n        align-self: center;\n        flex-grow: 1;\n        text-align: center;\n        cursor: pointer;\n        display: flex;\n        flex-direction: column;\n    }\n</style>";const tabTemplate=document.createElement("template");tabTemplate.innerHTML="<slot>\x3c!-- ICON SLOT --\x3e</slot>\n<span>\x3c!-- title --\x3e</span>\n\n<style>\n    ::slotted(moko-icon) {\n        flex-grow: 1;\n        height: 18px;\n        padding-bottom: 5px;\n    }\n    span {\n        flex-grow: 1;\n    }\n</style>",window.ShadyCSS&&(ShadyCSS.prepareTemplate(tabBarTemplate,"moko-tab-bar"),ShadyCSS.prepareTemplate(tabTemplate,"moko-tab"));class Tab extends HTMLElement{static get observedAttributes(){return["title","name"]}attributeChangedCallback(t,e,a){switch(t){case"title":this._title=a;break;case"name":this._name=a}}constructor(){super(),this.attachShadow({mode:"open"}).appendChild(tabTemplate.content.cloneNode(!0))}connectedCallback(){window.ShadyCSS&&ShadyCSS.styleElement(this);const t=this.shadowRoot.querySelector("span");this.getAttribute("title")&&(t.innerHTML=this.getAttribute("title")),this.querySelector("moko-icon")&&(t.style.fontSize="0.7em")}get name(){return this._name}get title(){return this._title}set name(t){this.setAttribute("name",t)}set title(t){this.setAttribute("title",t)}}customElements.define("moko-tab",Tab);class TabBar extends HTMLElement{static get observedAttributes(){return["active-color"]}attributeChangedCallback(t,e,a){switch(t){case"active-color":this._activeColor=a}}constructor(){super(),this.attachShadow({mode:"open"}).appendChild(tabBarTemplate.content.cloneNode(!0))}resetActiveColorForTabs(){Array.prototype.forEach.call(this.querySelectorAll("moko-tab"),t=>{t.style.color=null})}connectedCallback(){window.ShadyCSS&&ShadyCSS.styleElement(this),this.onclick=(t=>{const e=t.target.closest("moko-tab");if(e){const t=e.getAttribute("name");this.resetActiveColorForTabs(),e.style.color=this.getAttribute("active-color"),this.dispatchEvent(new CustomEvent("moko-tab-selected",{detail:{name:t}}))}})}get activeColor(){return this._activeColor||"#A06CD5"}set activeColor(t){this.setAttribute("active-color",t)}set selected(t){this._currentTabSelected=this.querySelector(`moko-tab[name="${t}"]`),this._currentTabSelected.style.color=this.activeColor}get currentTabSelected(){return this._currentTabSelected}}customElements.define("moko-tab-bar",TabBar);class MokoRoute extends HTMLElement{static get observedAttributes(){return["path","component","selected"]}removeFirstSlash(t){return 0===t.indexOf("/")?t.substring(1):t}attributeChangedCallback(t,e,a){"path"===t?this._path=this.removeFirstSlash(a):"component"===t?this._element||(this._element=a):"selected"===t&&(this._selected=a)}get path(){return this._path}get customElement(){return this._element}set path(t){this.setAttribute("path",t)}get selected(){return this._selected}set selected(t){this.setAttribute("selected",t)}}customElements.define("moko-route",MokoRoute);class TabRoute extends MokoRoute{static get observedAttributes(){return[...MokoRoute.observedAttributes,"title","icon"]}attributeChangedCallback(t,e,a){super.attributeChangedCallback(t,e,a),"icon"===t?this._icon=a:"title"===t&&(this._title=a)}set title(t){this.setAttribute("title",t)}set icon(t){this.setAttribute("icon",t)}get title(){return this._title}get icon(){return this._icon}}customElements.define("moko-tab-route",TabRoute);const tabTemplate$1=document.createElement("template");tabTemplate$1.innerHTML='\n<div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; height: 100%; width: 100%">\n    <div></div>\n    <moko-tab-bar></moko-tab-bar>\n</div>\n';class TabNavigator extends NavigatorElement{static get observedAttributes(){return["active-color"]}attributeChangedCallback(t,e,a){switch(t){case"active-color":this._activeColor=a}}connectedCallback(){super.connectedCallback(),this.style.display="block",this.style.height="inherit",this.style.width="inherit",this.style.position="relative";const t=this.getAttribute("default-path"),e=this.getContentElement();e&&e.remove(),this.containers={},this.scrollsTop={};const a=tabTemplate$1.content.cloneNode(!0);this.appendChild(a),this.$tabbar=this.querySelector("moko-tab-bar"),this.$tabbar.activeColor=this._activeColor||"#A06CD5",this.routes.forEach(t=>{const e=document.createElement("moko-tab");e.title=t.title,e.name=t.path,t.icon&&(e.innerHTML=`<moko-icon name="${t.icon}"></moko-icon>`),this.$tabbar.appendChild(e)}),location.hash?this.handleEvent():this.navigate(t||this.routes[0].path),this.$tabbar.addEventListener("moko-tab-selected",t=>{this.currentTabPath=t.detail.name,this.navigate(t.detail.name)})}getContentElement(){return this.lastElementChild.firstElementChild||this.lastElementChild}extractChildRoutes(){this.routes=Array.from(this.children).filter(t=>"MOKO-TAB-ROUTE"===t.tagName)}handleEvent(){this.scrollsTop[this.matchedRouteLocation]=this.getContentElement()&&this.getContentElement().scrollTop;const{matchedResult:t,matchedRoute:e,routeChanged:a}=this.searchMatchingRoute();if(t&&a){if(this.containers[e.path])this.syncHref(this.containers[e.path]);else{const a=document.createElement(e.customElement);a.style.display="block",a.style.overflow="scroll",a.style.width="inherit",a.style.height="inherit",Object.keys(this.urlData).forEach(e=>{a.setAttribute(e,t.urlData[e])}),this.containers[e.path]=a}this.getContentElement().replaceWith(this.containers[e.path]),this.getContentElement().scroll(0,this.scrollsTop[e.path]||0),this.$tabbar.resetActiveColorForTabs(),this.$tabbar.selected=e.path}}syncHref(t=this){const e=[...t.querySelectorAll("moko-tab-navigator, moko-switch-navigator, moko-stack-navigator")],a=location.href.split("#")[0]+"#"+this.getAncestorMatchedRoute()+(this.getAncestorMatchedRoute()?"/":"")+this.matchedRouteLocation;e.reduce((t,e)=>{const a=`${t}/${e.matchedRouteLocation}`;return a!==location.href?history.pushState({},a,a):history.replaceState({},a,a),a},a)}}customElements.define("moko-tab-navigator",TabNavigator);export{TabRoute,TabNavigator};
